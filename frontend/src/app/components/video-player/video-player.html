<div class="video-player-container">
  <!-- Settings Panel -->
  <div class="settings-panel" *ngIf="showSettings && !isConnected">
    <h3>Настройки подключения</h3>

    <div class="settings-form">
      <div class="form-group">
        <label for="rtspUrl">RTSP URL камеры</label>
        <input
          id="rtspUrl"
          type="text"
          [(ngModel)]="rtspUrl"
          placeholder="rtsp://user:pass@192.168.1.100:554/stream"
          class="form-input"
          [disabled]="isConnecting"
        />
        <small>Формат: rtsp://логин:пароль@IP:порт/путь</small>
      </div>

      <div class="form-group">
        <label for="turnUrl">TURN сервер</label>
        <input
          id="turnUrl"
          type="text"
          [(ngModel)]="turnServerUrl"
          placeholder="localhost:3478"
          class="form-input"
          [disabled]="isConnecting"
        />
        <small>Формат: IP:порт (например: 192.168.1.10:3478)</small>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="turnUser">TURN Логин</label>
          <input
            id="turnUser"
            type="text"
            [(ngModel)]="turnUsername"
            placeholder="turnuser"
            class="form-input"
            [disabled]="isConnecting"
          />
        </div>

        <div class="form-group">
          <label for="turnPass">TURN Пароль</label>
          <input
            id="turnPass"
            type="password"
            [(ngModel)]="turnPassword"
            placeholder="turnpassword"
            class="form-input"
            [disabled]="isConnecting"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Video Player -->
  <div class="video-wrapper">
    <video
      #videoElement
      class="video-element"
      autoplay
      playsinline
      muted
      controls
    ></video>

    <div class="video-overlay" *ngIf="!isConnected">
      <div class="overlay-content">
        <div *ngIf="isConnecting" class="loading">
          <div class="spinner"></div>
          <p>Подключение к потоку...</p>
        </div>

        <div *ngIf="!isConnecting && !isConnected && !errorMessage" class="ready">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10" stroke-width="2"/>
            <polygon points="10 8 16 12 10 16 10 8" fill="currentColor"/>
          </svg>
          <p>Настройте параметры и нажмите "Подключить"</p>
        </div>

        <div *ngIf="errorMessage" class="error">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10" stroke-width="2"/>
            <line x1="15" y1="9" x2="9" y2="15" stroke-width="2"/>
            <line x1="9" y1="9" x2="15" y2="15" stroke-width="2"/>
          </svg>
          <p>Ошибка: {{ errorMessage }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <button
      *ngIf="!isConnected"
      (click)="connect()"
      [disabled]="isConnecting"
      class="btn btn-primary"
    >
      {{ isConnecting ? 'Подключение...' : 'Подключить' }}
    </button>

    <button
      *ngIf="isConnected"
      (click)="disconnect()"
      class="btn btn-danger"
    >
      Отключить
    </button>

    <button
      *ngIf="isConnected"
      (click)="toggleSettings()"
      class="btn btn-secondary"
    >
      Настройки
    </button>

    <button
      *ngIf="errorMessage"
      (click)="reconnect()"
      class="btn btn-secondary"
    >
      Переподключить
    </button>
  </div>

  <!-- Stream Info -->
  <div class="stream-info">
    <p><strong>RTSP:</strong> <code class="url-display">{{ rtspUrl || 'не указан' }}</code></p>
    <p><strong>TURN:</strong> <code class="url-display">{{ turnServerUrl || 'не указан' }}</code></p>
    <p><strong>Статус:</strong>
      <span [class.status-connected]="isConnected"
            [class.status-disconnected]="!isConnected && !isConnecting"
            [class.status-connecting]="isConnecting">
        {{ isConnecting ? 'Подключение...' : (isConnected ? 'Подключено' : 'Отключено') }}
      </span>
    </p>
  </div>
</div>
